---
title: "Stats Modeling Project"
author: "Group 5: Xin Jin, Reid Ginoza, Heidi Lovejoy"
date: "11/18/2019"
# header-includes:
#    - \usepackage{amsmath, amssymb}
   # - \usepackage{natbib}
   # - \usepackage{hyperref}
output: pdf_document
bibliography: bibliography.bib
nocite: | 
  @rlang
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(pgirmess)
library(car)
library(pander)
library(scales)  # for percent
library(tidyverse)
library(broom)
library(knitr)
# options(kableExtra.latex.load_packages = FALSE)
library(kableExtra) # for tables
library(magrittr)  # provides more pipe oeprators
library(haven)
# options(knitr.table.format = "latex")

almost_sas <- function(aov.results){
  par(mfrow=c(2,2))
  plot(aov.results, which=1)
  plot(aov.results, which=2)
  aov_residuals <- residuals(aov.results)
  plot(density(aov_residuals))
  hist(aov_residuals)
}

p.value.string = function(p.value){
  p.value <- round(p.value, digits = 4)
  if (p.value == 0) {
    return("p < 0.0001")
  } else {
    return(paste0("p = ", format(p.value, scientific = F)))
  }
}
```

```{r import data}
institution_data <- read_spss('InstLevel.sav') %>%
  select(institution_name, state_cd, ClassificationCode, Classification=classification_name, sector_cd, sector_name, HDCOACH_SALARY_MEN, HDCOACH_SALARY_WOMEN, IL_PARTIC_MEN, IL_PARTIC_WOMEN, IL_PARTIC_COED_MEN, IL_PARTIC_COED_WOMEN) %>%
  filter(grepl('4-year', sector_name))  %>% # only 4-year Schools
  filter(is.na(IL_PARTIC_COED_MEN) | IL_PARTIC_COED_MEN == 0 ) %>% # only schools with no male participants in coed
  filter(is.na(IL_PARTIC_COED_WOMEN) | IL_PARTIC_COED_WOMEN == 0 ) %>% # only schools with no female participants in coed
  select(-contains("COED")) %>% # ignore variables with the word "coed"
  filter(!is.na(HDCOACH_SALARY_MEN)) %>% # filter out NA
  filter(!is.na(HDCOACH_SALARY_WOMEN)) %>% # filter out NA
  type.convert()

ncaa.div.i_data <- institution_data %>%
  filter(grepl('NCAA Division I-', Classification)) # only NCAA division 1

men_data <- institution_data %>%
  select(-contains("WOMEN")) %>% 
  rename(Salary = HDCOACH_SALARY_MEN, Participation = IL_PARTIC_MEN)

women_data <- institution_data %>%
  select(-contains("_MEN")) %>%
  rename(Salary = HDCOACH_SALARY_WOMEN, Participation = IL_PARTIC_WOMEN)

gender.separated_data <- bind_rows(
  men_data %>% add_column(Gender = "Men"),
  women_data %>% add_column(Gender = "Women")
)
```

# Introduction
<!-- %TODO Briefly give meaning to your project â€“ what is the background and why is this project important?  (20 points) -->
While it seems to be common knownledge that some of the highest paid public employees are college sports teams coaches, less is known about the salaries of college-level sports coaches in general. This project examined predictors of head coach salaries of sports teams at four-year colleges and universities in the United States. We used the institution-level data from the Equity in Athletics Survey, Year 2017-2018, from the U.S. Department of Education Office of Postsecondary Education [-@EADA2018]. Our analysis focused on the differences of head coach salaries between male and female teams, of classification, and of the number of student participants at an institution level. The classification consists of the athletic association, the division and subdivisions if applicable, such as NCAA Division I-FBS, NCAA Division I-FCS and NCAA Division I without football.

The full data set listed completed surveys for 2079 institutions. The 578 two-year colleges were excluded, as well as the 120 four-year schools with coed teams and 18 other institutions with missing values for head coach salaries. Our working data set had 1363 four-year institutions without coed sports teams.

# Hypotheses
<!-- %TODO Clearly state the hypotheses being tested. (20 points) -->
We examined whether the classifications and the gender of the team had effects on the head coach salaries. To do that, we first investigated the variances of head coach salaries of male teams compared with that of female teams. We checked for interaction effects between classification and gender of team. We also looked at whether the number of participants institution-wide predicted the salary for the head coaches.

# Methods
<!-- %TODO State and explain the methodology used to test the hypotheses.  (20 points) -->
Data was analyzed using R version 3.6.1 (2019-07-05) [@rlang]. The data was described using counts (percentage) for categorical variables and mean (standard deviation) for continuous variables.

To examine the interactions of gender and classification, a two-way ANOVA was used. A Brown-Forsythe-Levene Test for homogeneity of variances was conducted on the variances of the classifications. After an examination of the residuals, a Kruskal-Wallis was used to test if there are differences between the classifications, and the posthoc Kruskal-Wallis procedure was used for pairwise comparisons.

# Results
## Description of Data
<!-- %TODO Describe the data (1st paragraph) -->
```{r continuous variables description part 1, include=FALSE}
# Couldn't figure out how to do what I wanted, so I made the table "by hand"
men.salary_mean <- institution_data$HDCOACH_SALARY_MEN %>% mean() %>% round(digits = 2) %>% prettyNum(big.mark=",", trim=TRUE, digits = 8, scientific = FALSE)
men.salary_sd <- institution_data$HDCOACH_SALARY_MEN %>% sd() %>% round(digits = 2) %>% prettyNum(big.mark=",", trim=TRUE, digits = 8, scientific = FALSE)
women.salary_mean <- institution_data$HDCOACH_SALARY_WOMEN %>% mean() %>% round(digits = 2) %>% prettyNum(big.mark=",", trim=TRUE, digits = 7, scientific = FALSE)
women.salary_sd <- institution_data$HDCOACH_SALARY_WOMEN %>% sd() %>% round(digits = 2) %>% prettyNum(big.mark=",", trim=TRUE, digits = 7, scientific = FALSE)
total.salary_mean <- gender.separated_data$Salary %>% mean() %>% round(digits = 2) %>% prettyNum(big.mark=",", trim=TRUE, digits = 7, scientific = FALSE)
total.salary_sd <- gender.separated_data$Salary %>% sd() %>% round(digits = 2) %>% prettyNum(big.mark=",", trim=TRUE, digits = 8, scientific = FALSE)

men.part_mean <- institution_data$IL_PARTIC_MEN %>% mean() %>% round(digits = 2)
men.part_sd <- institution_data$IL_PARTIC_MEN %>% sd() %>% round(digits = 2)
women.part_mean <- institution_data$IL_PARTIC_WOMEN %>% mean() %>% round(digits = 2)
women.part_sd <- institution_data$IL_PARTIC_WOMEN %>% sd() %>% round(digits = 2)
total.participation_data <- institution_data %>% mutate(Total.Participation = IL_PARTIC_MEN + IL_PARTIC_WOMEN) %>% select (Total.Participation)
total.part_mean <- total.participation_data$Total.Participation %>% mean() %>% round(digits = 2)
total.part_sd <- total.participation_data$Total.Participation %>% sd() %>% round(digits = 2)

tribble(
  ~Variable, ~Mean, ~SD,
  "Head Coach--Men's Salary", men.salary_mean, men.salary_sd,
  "Head Coach--Women's Salary", women.salary_mean, women.salary_sd,
  "Head Coach--All Salary", total.salary_mean, total.salary_sd,
  "Participation--Men", men.part_mean, men.part_sd,
  "Participation--Women", women.part_mean, women.part_sd,
  "Participation--Total", total.part_mean, total.part_sd
) %>% kable(booktabs = T) -> summary.table.text
```
`r summary.table.text`
```{r categorical variables description}
institution_data %>% group_by(Classification) %>% summarize(Count = n()) %>%
  mutate(Percentage = percent(Count / 1363)) %>% kable(booktabs = T)
```

```{r describe head coach salaries, echo=FALSE, message=FALSE}
gender.separated_data %>%
  ggplot(aes(x = Salary, fill = Gender)) +
  geom_histogram(position = "dodge") +
  labs(title="Head Coach Salary", x = "Salary (USD)",
       y = "Count", fill = "Gender:") +
  theme(
    legend.position="bottom",
    panel.background = element_rect(fill = 'white', color = 'grey'),
    panel.grid.major = element_line(size = 0.25, linetype = 'solid',
                                color = "grey"), 
    panel.grid.minor = element_line(size = 0.1, linetype = 'solid',
                                color = "grey")
  ) +
  scale_x_continuous(labels = comma)
```


## Analysis Results
<!-- %TODO Analysis results (order of results should correspond to hypotheses listed).  (20 points) -->

```{r BFL gender}

```

```{r Wilcoxon gender}

```

```{r twoway ANOVA interaction between classification and gender}
classification.gender.interaction.results <- gender.separated_data %$% aov(Salary ~ Classification * Gender)
```

```{r profile plots, echo=FALSE}
gender.separated_data %>% 
  ggplot() +
  aes(x = Classification, color = Gender, group = Gender, y = Salary) +
  stat_summary(fun.y = mean, geom = "point") +
  stat_summary(fun.y = mean, geom = "line") + 
  labs(
    title = "Profile Plot of Salary by Classification and Gender",
    x = "Classification",
    y = "Salary (USD)"
    ) + 
  theme_bw() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
  scale_y_continuous(labels = comma)
```

While this profile plot shows interaction effects, upon visual inspection, it seems to be limited to the three NCAA Division I classifications: NCAA Division I without football, NCAA Division I-FBS, and NCAA Division I-FCS. In those three cases, head coaches for men's teams have higher salaries, especially in the case of NCAA Division I-FBS.

To check the assumptions of the ANOVA model, we examined the variance across classifications to see if the variance was constant and the normality of the residuals.

```{r classification variance test}
gender.separated_data %$% leveneTest(Salary ~ Classification, center = median) -> classification.variance.results
```
The Brown-Forsythe-Levene Test for Homogeneity of Variances resulted in a test statistic of \(F_0 = `r classification.variance.results$"F value"[1] %>% round(digits=2)`\) (\(`r classification.variance.results$"Pr(>F)"[1] %>% p.value.string`\)), so there is sufficient evidence to suggest that at least one of the classifications' salaries have a variance different from the others.

Upon a visual examination of the residuals and the q-q plot, it is also clear that the normality assumptions of the residuals was not satisfied.
```{r ANOVA assumptions}
classification.gender.interaction.results %>% almost_sas()
```

```{r Kruskal Wallis classification}
classification.kw.test <- gender.separated_data %$% kruskal.test(Salary ~ Classification) %>% tidy()
```
The Kruskal-Wallis test on the salaries grouped by classifications resulted in a test statistic \(H = `r classification.kw.test$statistic %>% round(digits=2)`\) (\(`r classification.kw.test$p.value %>% p.value.string`\)), so there is sufficient evidence to suggest that at least one classification is different from the others. Thus, the posthoc procedure for the Kruskal-Wallis test was completed to find pairwise differences between the classifications.

```{r posthoc Kruskal Wallis}
classification.kw.posthoc <- gender.separated_data %$% kruskalmc(Salary ~ Classification)
```

From the 153 possible pairwise comparisons, 91 resulted in significant difference. Complete results are not included, but these are the summaries regarding the NCAA Division I: NCAA Division I-FBS had a significant difference from the 17 other classifications, NCAA Division I-FCS had a significant different from 16 other classifications, NCAA Division I without football the only exception, and similarly with NCAA Division I without football, the only non-significant difference was with NCAA Division I-FCS.

```{r linear regression participants}

```

```{r linear regression appropriate}

```

# Conclusion
<!-- %TODO Restate the results in terms of the larger picture; state limitations and opportunities for future research (20 points) -->

Examining the interaction effects between classification and gender, reveleated that the NCAA Division I had the most differences between male and female head coaches. Furthermore, it appears that the NCAA Division I, with its different subdivisions (FBS, FCS, without football) were each different from all of the remaining classifications. This makes sense as there are different funding allowances between these subdivisions, but only between football teams. A future study might investigate the head coach salaries of collegiate football head coaches separately from the other sports or compare head coaches across classification and sport. Perhaps the sport of football is where the greatest gender disparity of salary exists.

Our data set contained only the averages of head coach salaries of a given institution, so we were unable to capture any variance within an institution. Additionally, this study only used the surveys from one year and future studies should investigate the salaries over multiple years.

This was an initial study of salaries of head coaches of collegiate sports teams. While there is more work to be done, we believe we have paved the way in identifying important factors of their salaries, and we hope others will continue the investigation.

# References